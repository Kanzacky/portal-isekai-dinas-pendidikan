{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 64, "column": 0}, "map": {"version":3,"sources":["file:///D:/StudyProject/portal-isekai-dinas-pendidikan/apps/frontend/lib/tools/generalTools.ts"],"sourcesContent":["import { MenuModel } from \"@/types\";\r\n\r\n/**\r\n * Helper untuk matching URL menu (Recursive)\r\n */\r\nexport const findMatchingItem = (menuData: Array<MenuModel>, url: string): boolean => {\r\n    for (const item of menuData) {\r\n        if (item.to && new RegExp(`^${item.to}(/|$)`).test(url)) return true;\r\n        if (item.items && findMatchingItem(item.items, url)) return true;\r\n    }\r\n    return false;\r\n};\r\n\r\n/**\r\n * Mencari item menu secara mendalam\r\n */\r\nexport const findToValuesRecursive = (data: Array<MenuModel>, searchToValue: string): Array<MenuModel> => {\r\n    const matching: Array<MenuModel> = [];\r\n    function search(items: Array<MenuModel>) {\r\n        for (const item of items) {\r\n            if (item.to === searchToValue) matching.push(item);\r\n            if (item.items) search(item.items);\r\n        }\r\n    }\r\n    search(data);\r\n    return matching;\r\n};\r\n\r\nexport const notify = (type: 'success' | 'error', message: string) => {\r\n    console.log(`[${type.toUpperCase()}]: ${message}`);\r\n};"],"names":[],"mappings":";;;;;;;;AAKO,MAAM,mBAAmB,CAAC,UAA4B;IACzD,KAAK,MAAM,QAAQ,SAAU;QACzB,IAAI,KAAK,EAAE,IAAI,IAAI,OAAO,CAAC,CAAC,EAAE,KAAK,EAAE,CAAC,KAAK,CAAC,EAAE,IAAI,CAAC,MAAM,OAAO;QAChE,IAAI,KAAK,KAAK,IAAI,iBAAiB,KAAK,KAAK,EAAE,MAAM,OAAO;IAChE;IACA,OAAO;AACX;AAKO,MAAM,wBAAwB,CAAC,MAAwB;IAC1D,MAAM,WAA6B,EAAE;IACrC,SAAS,OAAO,KAAuB;QACnC,KAAK,MAAM,QAAQ,MAAO;YACtB,IAAI,KAAK,EAAE,KAAK,eAAe,SAAS,IAAI,CAAC;YAC7C,IAAI,KAAK,KAAK,EAAE,OAAO,KAAK,KAAK;QACrC;IACJ;IACA,OAAO;IACP,OAAO;AACX;AAEO,MAAM,SAAS,CAAC,MAA2B;IAC9C,QAAQ,GAAG,CAAC,CAAC,CAAC,EAAE,KAAK,WAAW,GAAG,GAAG,EAAE,SAAS;AACrD"}},
    {"offset": {"line": 97, "column": 0}, "map": {"version":3,"sources":["file:///D:/StudyProject/portal-isekai-dinas-pendidikan/apps/frontend/lib/tools/authTools.ts"],"sourcesContent":["import NextAuth from \"next-auth\";\r\nimport Credentials from \"next-auth/providers/credentials\";\r\n\r\nexport const { handlers, auth, signIn, signOut } = NextAuth({\r\n    providers: [\r\n        Credentials({\r\n            credentials: {\r\n                userData: {},\r\n            },\r\n            async authorize(credentials) {\r\n                if (credentials?.userData) {\r\n                    return JSON.parse(credentials.userData as string);\r\n                }\r\n                return null;\r\n            },\r\n        }),\r\n    ],\r\n    secret: process.env.NEXTAUTH_SECRET, \r\n    callbacks: {\r\n        async jwt({ token, user }: any) {\r\n            if (user) token.user = user;\r\n            return token;\r\n        },\r\n        async session({ session, token }: any) {\r\n            session.user = token.user;\r\n            return session;\r\n        },\r\n    },\r\n});"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;AAAA;;;AAEO,MAAM,EAAE,QAAQ,EAAE,IAAI,EAAE,MAAM,EAAE,OAAO,EAAE,GAAG,IAAA,gKAAQ,EAAC;IACxD,WAAW;QACP,IAAA,qKAAW,EAAC;YACR,aAAa;gBACT,UAAU,CAAC;YACf;YACA,MAAM,WAAU,WAAW;gBACvB,IAAI,aAAa,UAAU;oBACvB,OAAO,KAAK,KAAK,CAAC,YAAY,QAAQ;gBAC1C;gBACA,OAAO;YACX;QACJ;KACH;IACD,QAAQ,QAAQ,GAAG,CAAC,eAAe;IACnC,WAAW;QACP,MAAM,KAAI,EAAE,KAAK,EAAE,IAAI,EAAO;YAC1B,IAAI,MAAM,MAAM,IAAI,GAAG;YACvB,OAAO;QACX;QACA,MAAM,SAAQ,EAAE,OAAO,EAAE,KAAK,EAAO;YACjC,QAAQ,IAAI,GAAG,MAAM,IAAI;YACzB,OAAO;QACX;IACJ;AACJ"}},
    {"offset": {"line": 142, "column": 0}, "map": {"version":3,"sources":["file:///D:/StudyProject/portal-isekai-dinas-pendidikan/apps/frontend/lib/tools/serverTools.ts"],"sourcesContent":["'use server'\r\n\r\nimport axios from \"axios\";\r\nimport { cookies } from 'next/headers';\r\nimport path from 'path';\r\nimport fs from 'fs';\r\nimport crypto from 'crypto';\r\nimport { parse } from 'date-fns';\r\nimport { findToValuesRecursive } from \"./generalTools\";\r\nimport { auth } from \"./authTools\"; \r\n\r\n/**\r\n * ENKRIPSI RSA - WAJIB DI SERVER\r\n */\r\nexport const encryptChunkRSA = async (payload: string) => {\r\n    const chunkSize = 214;\r\n    const chunks = payload.match(new RegExp(`.{1,${chunkSize}}`, 'g')) || [];\r\n    const encryptedChunks = [];\r\n\r\n    const pubKeyPath = path.join(process.cwd(), 'lib', 'key', 'public.pem');\r\n\r\n    console.log(\"Mencari Key di:\", pubKeyPath); \r\n\r\n    if (!fs.existsSync(pubKeyPath)) {\r\n        const altPath = path.join(process.cwd(), 'apps', 'frontend', 'lib', 'key', 'public.pem');\r\n        if (fs.existsSync(altPath)) {\r\n            var pubKey = fs.readFileSync(altPath, 'utf8');\r\n        } else {\r\n            throw new Error(`Public key NOT FOUND. Terdeteksi di: ${pubKeyPath}`);\r\n        }\r\n    } else {\r\n        var pubKey = fs.readFileSync(pubKeyPath, 'utf8');\r\n    }\r\n\r\n    // Proses enkripsi tetap sama...\r\n    for (const chunk of chunks) {\r\n        const encrypted = crypto.publicEncrypt(\r\n            {\r\n                key: pubKey,\r\n                padding: crypto.constants.RSA_PKCS1_OAEP_PADDING,\r\n            },\r\n            Buffer.from(chunk)\r\n        );\r\n        encryptedChunks.push(encrypted.toString('base64'));\r\n    }\r\n    return encryptedChunks.join('||');\r\n}\r\n/**\r\n * LOGOUT ACTION\r\n */\r\n\r\nexport const logoutAction = async () => {\r\n    const cookieStore = await cookies(); \r\n    cookieStore.delete(\"_A2R\");\r\n    cookieStore.delete(\"_A2F\");\r\n};\r\n\r\n/**\r\n * ROUTE MIDDLEWARE & MENU CHECK\r\n */\r\nexport const routeMiddleware = async (searchUrl: string) => {\r\n    const session = await auth();\r\n\r\n    if (!session?.user) return '99'; // Not Logged In\r\n\r\n    try {\r\n        // 1. Cek Expiry Session\r\n        const dSessionExp = parse(session.expires, 'yyyy-MM-dd HH:mm:ss', new Date());\r\n        if (new Date().getTime() > dSessionExp.getTime()) return '99';\r\n\r\n        if (!session.user.uniqueId) return '99';\r\n\r\n        // 2. Fetch Menu dari Backend Perusahaan\r\n        const resp = await axios.post(\r\n            `${process.env.NEXT_PUBLIC_API_DIR_PATH}`,\r\n            { UniqueId: session.user.uniqueId },\r\n            {\r\n                headers: {\r\n                    'X-ENDPOINT': \"/setup/nav/user-data\",\r\n                    'X-Level': \"1\",\r\n                    'X-Timestamp': new Date().toISOString() // Memperbaiki bug Missing Timestamp\r\n                }\r\n            }\r\n        );\r\n\r\n        const menu = resp.data.data;\r\n        const urlFix = searchUrl.length > 1 ? searchUrl.replace(/\\/$/, '') : searchUrl;\r\n\r\n        // 3. Validasi Hak Akses Menu\r\n        const res = findToValuesRecursive(menu, urlFix);\r\n        return res.length < 1 ? '98' : '00'; // 98 = No Access, 00 = Authorized\r\n\r\n    } catch (error: any) {\r\n        console.error(\"Auth Middleware Error:\", error.response?.data || error.message);\r\n        return error.response?.status === 401 ? '99' : '500';\r\n    }\r\n};"],"names":[],"mappings":";;;;;;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;AAKO,MAAM,kBAAkB,OAAO;IAClC,MAAM,YAAY;IAClB,MAAM,SAAS,QAAQ,KAAK,CAAC,IAAI,OAAO,CAAC,IAAI,EAAE,UAAU,CAAC,CAAC,EAAE,SAAS,EAAE;IACxE,MAAM,kBAAkB,EAAE;IAE1B,MAAM,aAAa,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,OAAO,OAAO;IAE1D,QAAQ,GAAG,CAAC,mBAAmB;IAE/B,IAAI,CAAC,wGAAE,CAAC,UAAU,CAAC,aAAa;QAC5B,MAAM,UAAU,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,QAAQ,YAAY,OAAO,OAAO;QAC3E,IAAI,wGAAE,CAAC,UAAU,CAAC,UAAU;YACxB,IAAI,SAAS,wGAAE,CAAC,YAAY,CAAC,SAAS;QAC1C,OAAO;YACH,MAAM,IAAI,MAAM,CAAC,qCAAqC,EAAE,YAAY;QACxE;IACJ,OAAO;QACH,IAAI,SAAS,wGAAE,CAAC,YAAY,CAAC,YAAY;IAC7C;IAEA,gCAAgC;IAChC,KAAK,MAAM,SAAS,OAAQ;QACxB,MAAM,YAAY,gHAAM,CAAC,aAAa,CAClC;YACI,KAAK;YACL,SAAS,gHAAM,CAAC,SAAS,CAAC,sBAAsB;QACpD,GACA,OAAO,IAAI,CAAC;QAEhB,gBAAgB,IAAI,CAAC,UAAU,QAAQ,CAAC;IAC5C;IACA,OAAO,gBAAgB,IAAI,CAAC;AAChC;AAKO,MAAM,eAAe;IACxB,MAAM,cAAc,MAAM,IAAA,0IAAO;IACjC,YAAY,MAAM,CAAC;IACnB,YAAY,MAAM,CAAC;AACvB;AAKO,MAAM,kBAAkB,OAAO;IAClC,MAAM,UAAU,MAAM,IAAA,iIAAI;IAE1B,IAAI,CAAC,SAAS,MAAM,OAAO,MAAM,gBAAgB;IAEjD,IAAI;QACA,wBAAwB;QACxB,MAAM,cAAc,IAAA,6JAAK,EAAC,QAAQ,OAAO,EAAE,uBAAuB,IAAI;QACtE,IAAI,IAAI,OAAO,OAAO,KAAK,YAAY,OAAO,IAAI,OAAO;QAEzD,IAAI,CAAC,QAAQ,IAAI,CAAC,QAAQ,EAAE,OAAO;QAEnC,wCAAwC;QACxC,MAAM,OAAO,MAAM,gJAAK,CAAC,IAAI,CACzB,qEAAyC,EACzC;YAAE,UAAU,QAAQ,IAAI,CAAC,QAAQ;QAAC,GAClC;YACI,SAAS;gBACL,cAAc;gBACd,WAAW;gBACX,eAAe,IAAI,OAAO,WAAW,GAAG,oCAAoC;YAChF;QACJ;QAGJ,MAAM,OAAO,KAAK,IAAI,CAAC,IAAI;QAC3B,MAAM,SAAS,UAAU,MAAM,GAAG,IAAI,UAAU,OAAO,CAAC,OAAO,MAAM;QAErE,6BAA6B;QAC7B,MAAM,MAAM,IAAA,qJAAqB,EAAC,MAAM;QACxC,OAAO,IAAI,MAAM,GAAG,IAAI,OAAO,MAAM,kCAAkC;IAE3E,EAAE,OAAO,OAAY;QACjB,QAAQ,KAAK,CAAC,0BAA0B,MAAM,QAAQ,EAAE,QAAQ,MAAM,OAAO;QAC7E,OAAO,MAAM,QAAQ,EAAE,WAAW,MAAM,OAAO;IACnD;AACJ;;;IAlFa;IAqCA;IASA;;AA9CA,+OAAA;AAqCA,+OAAA;AASA,+OAAA"}},
    {"offset": {"line": 241, "column": 0}, "map": {"version":3,"sources":["file:///D:/StudyProject/portal-isekai-dinas-pendidikan/apps/frontend/.next-internal/server/app/%28full-page%29/auth/login/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {encryptChunkRSA as '40ae624e1e2d8466554756e3ec5e42bb1a1f99437e'} from 'ACTIONS_MODULE0'\nexport {logoutAction as '006b9e20f52a4f45e8c731bc46af9c5a078cfaca92'} from 'ACTIONS_MODULE0'\nexport {routeMiddleware as '40406488588ad9999ac2ebce31bfd557b07ebc3660'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA"}}]
}